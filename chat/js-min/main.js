/*! chat 2014-11-22 */
function isWeiXin(){var a=window.navigator.userAgent;"MicroMessenger/6.0"==a.match(/MicroMessenger\/6.0/i)&&$("#body").addClass("weixin6")}function position_monitor(){wHeight=document.documentElement.clientHeight;var a=wHeight-headHeight-bannerHeight-chatMarginHeight-inputHeight;$("#chatBlock").height(a)}function setLayerHeight(a){var b=wHeight-headHeight-bannerHeight,c=a.height();b>c&&a.find(".layer_content").height(b-76)}function getParameter(a){var b=a.toLowerCase()+"=",c="",d=location.href,e=location.href.toLowerCase();return e.indexOf(b)>0&&(c=d.substring(e.indexOf(b)+b.length,e.length),c.indexOf("&")>0&&(c=c.substring(0,c.indexOf("&"))),c.indexOf("#")>0&&(c=c.split("#")[0])),c}function enterRoom(){var a=postUrl+"enterRoom",b={openid:randomOpenid,appid:appid,usernick:encodeURIComponent(myNick),usericon:encodeURIComponent(myIcon),usersex:mySex,timeStamp:timeStamp,key:key};console.log(b),$("#enteringRoom").fadeIn(600),1==debugMode&&console.log("sendPara:  openid="+randomOpenid+"\n appid="+appid+"\n timeStamp="+timeStamp+"\n key="+key+"\n usericon="+encodeURIComponent(myIcon)+"\n usernick="+encodeURIComponent(myNick)+"\n usersex="+mySex),$.ajax({type:"POST",url:a,data:b,dataType:"jsonp",jsonp:"callback",timeout:globalTimeout,contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(a){$("#enteringRoom").fadeOut(200),3==a.ret&&(window.location.href="http://1251097942.cdn.myqcloud.com/1251097942/passed_v2.0/passed.html"),2==a.ret&&(alert("验证失败~请重新进入！"),reEnter()),1==a.ret&&(window.location.href="error.html"),0==a.ret&&(setTimeout(function(){$("#entered").show().delay(1e3).fadeOut(400)},1e3),ccode=a.ccode,myRoomNumber=a.roomId,getChatContent(),yanshiMode||(myNick=a.nickname,myIcon=a.icon,mySex=a.sex),myDeco=parseInt(a.deco)+1),1==debugMode&&console.log("enterRoom:  ret="+a.ret+" ccode="+a.ccode+" roomId="+a.roomId+" deco="+a.deco)},error:function(a,b,c){$("#enteringRoom").fadeOut(200),1==debugMode&&alert("http:responseText"+a.responseText+"\n readyState"+a.readyState+"\n status"+a.status+"\ninfo:"+b+"\nexception:"+c),reEnter()}})}function reEnter(){window.location.href=reenterUrl}function getChatContent(){var a=postUrl+"flash";console.log(a);var b={openid:randomOpenid,appid:appid,ccode:ccode};$.ajax({type:"POST",url:a,data:b,dataType:"jsonp",jsonp:"callback",timeout:globalTimeout,contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(a){0==a.ret&&(totalMessageNumber+=a.chat.length,totalMessageNumber>50&&(clearMessage(),totalMessageNumber=0,pushMsg(lastChat)),lastChat=a.chat,ccode=a.ccode,roomPeople!=a.cnum&&(roomPeople=a.cnum,changePeopleNumber(roomPeople)),pushSystemMsg(a.sysmsg),pushMsg(a.chat),console.log(a),console.log("scenebt is "+a.scenebt),""!=a.scenebt&&(sceneid!=a.sceneid||scenebt!=a.scenebt||0==sceneid)&&(console.log("entersi"),getSceneContent(a.sceneid),console.log(sceneid,scenebt)),scenebt=a.scenebt,sceneid=a.sceneid,$("#error-loadingscene").hide(),setTimeout("getChatContent()",flashInterval)),1==a.ret&&(ccode=a.ccode,flashLimit++,1==debugMode&&alert("刷消息返回1第"+flashLimit+"次"),flashLimit>1||setTimeout("getChatContent()",flashInterval))},error:function(){1==debugMode&&alert("刷消息timeout了！网络断了吗？")}})}function getSceneContent(a){var b=postUrl+"submitSceneid",c={openid:randomOpenid,appid:appid,sceneid:a};$.ajax({type:"POST",url:b,data:c,dataType:"jsonp",jsonp:"callback",timeout:globalTimeout,contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(a){0==a.ret&&loadScene(a,a.ret,a.des,a.clist,a.tiid,a.bpath,a.chose),1==debugMode&&console.log("getSceneContent: ret="+a.ret,"des="+a.des,"clist="+a.clist,"tiid="+a.tiid,"bpath="+a.bpath,"chose="+a.chose)},error:function(a,b,c){1==debugMode&&alert("http:responseText"+a.responseText+"\n readyState"+a.readyState+"\n status"+a.status+"\ninfo:"+b+"\nexception:"+c)}})}function getJingcaiContent(a){var b=postUrl+"submitSceneid",c={openid:randomOpenid,appid:appid,sceneid:a};$.ajax({type:"POST",url:b,data:c,dataType:"jsonp",jsonp:"callback",timeout:globalTimeout,contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(a){0==a.ret&&renderJingcaiLayer(a),1==debugMode&&(console.log("getJingcaiContent below"),console.dir(a))},error:function(a,b,c){1==debugMode&&alert("http:responseText"+a.responseText+"\n readyState"+a.readyState+"\n status"+a.status+"\ninfo:"+b+"\nexception:"+c)}})}function updateJingcaiContent(a){var b=postUrl+"submitSceneid",c={openid:randomOpenid,appid:appid,sceneid:a};$.ajax({type:"POST",url:b,data:c,dataType:"jsonp",jsonp:"callback",timeout:globalTimeout,contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(a){0==a.ret&&updateJingcaiLayer(a),1==debugMode&&(console.log("updateJingcaiContent below"),console.dir(a))},error:function(a,b,c){1==debugMode&&alert("http:responseText"+a.responseText+"\n readyState"+a.readyState+"\n status"+a.status+"\ninfo:"+b+"\nexception:"+c)}})}function changePeopleNumber(a){$("#current-number").html(a)}function pushSystemMsg(a){if(a=decodeURI(a),a=zhuan(a),""!=a){var b='<div class="system_notify"><p><span>'+a+"</p></div>";$("#chatBlock").append(b),$("#chatBlock").scrollTo($("#chatBlock .single_chat:last"),400)}}function clearMessage(){$("#chatBlock").html(" ")}function pushMsg(a){if(null==a||a.length<=0)return!1;myIcon=zhuan(myIcon),myNick=zhuan(myNick),a=zhuan(a);var b=a.length;b>30&&(b=30);for(var c=0;b>c;c++){var d='<div class="single_chat">            <div class="user_photo"><img src='+a[c].icon+' ></div>            <div class="user_name">'+decodeURI(a[c].nick)+'</div>            <div class="user_words">'+a[c].msg+"</div>        </div>",e='<div class="single_chat">            <div class="user_photo"><img src='+a[c].icon+' ></div>            <div class="user_name">'+decodeURI(a[c].nick)+'</div>            <div class="user_bq"><img src="'+a[c].msg+'"></div>        </div>';if(a[c].openid!=randomOpenid){var f=/^images/gi,g=/.gif*/gi,h=a[c].msg.match(f),i=a[c].msg.match(g);$("#chatBlock").append(null!=h&&null!=i?e:d),$("#chatBlock").scrollTo($("#chatBlock .single_chat:last"),50),2==a[c].sex&&($("#chatBlock .single_chat:last").addClass("female"),void 0!=a[c].deco&&$("#chatBlock .single_chat:last").addClass("deco"+(parseInt(a[c].deco)+1)/1))}0==a[c].type&&a[c].openid==randomOpenid&&($("#chatBlock").append(d),$("#chatBlock").scrollTo($("#chatBlock .single_chat:last"),50),$("#chatBlock .single_chat:last").addClass("me"),2==a[c].sex&&($("#chatBlock .single_chat:last").addClass("female"),void 0!=a[c].deco&&$("#chatBlock .single_chat:last").addClass("deco"+(parseInt(a[c].deco)+1)/1))),1==debugMode&&console.log("pushMsg: chat.nick="+a[c].nick+" chat.icon="+a[c].icon+" chat.ts="+a[c].ts+" chat.sex="+a[c].sex+" chat.msg="+a[c].msg+"chatMsg[i].type="+a[c].type+" chat.randomOpenid="+a[c].randomOpenid+"openid"+randomOpenid)}}function pushMyMsg(a){myMessageId+=1,myIcon=decodeURI(zhuan(myIcon)),myNick=zhuan(myNick),a=zhuan(a);var b='<div class="single_chat me" id="messageId'+myMessageId+'">  <div class="user_photo"><img src='+myIcon+' ></div>  <div class="user_name">'+myNick+'</div>  <div class="user_words">'+a+'		<div id="sending-msg" class="circleG_holder circleG_msg">                <div class="circleG circleG1"></div>                <div class="circleG circleG2"></div>                <div class="circleG circleG3"></div>     </div>		<div class="error_sending"></div>  </div></div>',c='<div class="single_chat me" id="messageId'+myMessageId+'">            <div class="user_photo"><img src='+myIcon+' ></div>            <div class="user_name">'+myNick+'</div>            <div class="user_bq"><img src="'+a+'"></div>        </div>',d=/^images/gi,e=/.gif*/gi,f=a.match(d),g=a.match(e);$("#chatBlock").append(null!=f&&null!=g?c:b),$("#chatBlock").scrollTo($("#chatBlock .single_chat:last"),400),2==mySex&&($("#chatBlock .single_chat:last").addClass("female"),void 0!=myDeco&&$("#chatBlock .single_chat:last").addClass("deco"+myDeco)),a.length<5&&$("#chatBlock .single_chat:last").addClass("one_row"),1==debugMode&&console.log("pushMyMsg: myNick="+myNick+" myIcon="+myIcon+" mySex="+mySex)}function sendMsg(a,b){0==b&&(a=encodeURIComponent(a));var c=postUrl+"chat",d={openid:randomOpenid,appid:appid,msg:a};$.ajax({type:"POST",url:c,data:d,dataType:"jsonp",jsonp:"callback",timeout:globalTimeout,contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(a){var b=$("#messageId"+myMessageId+" .circleG_msg"),c=$("#messageId"+myMessageId+" .error_sending");0==a.ret?b.fadeOut("4000",function(){b.remove()}):(b.remove(),c.show()),1==debugMode&&console.log("sendMsg: ret"+a.ret,"cts:"+a.cts)},error:function(a,b,c){var d=$("#messageId"+myMessageId+" .circleG_msg"),e=$("#messageId"+myMessageId+" .error_sending");d.remove(),e.show(),1==debugMode&&alert("http:responseText"+a.responseText+"\n readyState"+a.readyState+"\n status"+a.status+"\ninfo:"+b+"\nexception:"+c)}})}function orient(){return 0==window.orientation||180==window.orientation?($("#restrict_heng").hide(),!1):90==window.orientation||-90==window.orientation?($("#restrict_heng").show(),!1):void 0}function loadScene(a,b,c,d,e,f,g){if($("#banner>div").fadeOut(),$(".slide_layer").hide(),1==sceneid);else if(2==sceneid){$("#banner-dati").fadeIn(),c=zhuan(c),$("#dati-timu").html(c);var h=d.length;$("#dati-btns").html("");for(var i=0;h>i;i++){var j='<span class="btn_normal btn_answer">'+zhuan(d[i].des)+"</span>";$("#dati-btns").append(j),1==debugMode&&console.log("loadScene: des:"+d[i].des)}if($("#dati-btns span").bind("tap",function(){if(!$("#dati-btns span").hasClass("on")){var a=$(this).index();submitMyDati(d[a].chooseId,a)}}),0!=g)for(var k=0;h>k;k++)1==debugMode&&console.log("setOn: passChose="+g,"passClist[i].chooseId="+d[k].chooseId),g==d[k].chooseId&&$("#dati-btns span").eq(k).addClass("on")}else if(3==sceneid)$("#banner-tuwen").fadeIn(),c=zhuan(c),$("#tuwen-des").html(c);else if(4==sceneid)$("#banner-image").fadeIn(),$("#banner-image img").attr("src",f),console.log("passBpath"+f);else if(5==sceneid){$("#banner-image").fadeIn();var l=f.indexOf("|"),m=f.substring(0,l),n=f.substring(l+1,f.length);$("#banner-image img").attr("src",m),$("#banner-image img").wrap("<a href='"+n+"'></a>"),console.log("passBpath"+f)}else 9==sceneid?renderJingcaiLayer(a):10==sceneid&&renderJingcaiLayer(a)}function updateVoteNum(a,b){var c=postUrl+"submitSceneid",d={openid:randomOpenid,appid:appid,sceneid:a};$.ajax({type:"POST",url:c,data:d,dataType:"jsonp",jsonp:"callback",timeout:globalTimeout,contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(a){if(0==a.ret){console.log("scene start1111"),console.log(a),console.log("scene start2222");var c,d;$(".f_pk_vs").html("你选择了</br>"+$(".playerName").eq(b).html()),0==b?($(".winBtn").eq(0).addClass("pkInBtn").html(a.result[0].vote+"票"),$(".winBtn").eq(1).addClass("pkInBtn").html(a.result[1].vote+"票"),d=$(".f_pk_person").eq(0).find("img"),c=$(".f_pk_person").eq(1).find("img")):($(".winBtn").eq(1).addClass("pkInBtn").html(a.result[1].vote+"票"),$(".winBtn").eq(0).addClass("pkInBtn").html(a.result[0].vote+"票"),d=$(".f_pk_person").eq(1).find("img"),c=$(".f_pk_person").eq(0).find("img")),$(".f_pk_person1").eq(0).attr("vote",a.result[0].vote),$(".f_pk_person2").eq(0).attr("vote",a.result[1].vote),c.attr("src",c.attr("src").split(".png")[0]+"-dark.png")}1==debugMode&&(console.log("updateJingcaiContent below"),console.dir(a))},error:function(a,b,c){1==debugMode&&alert("http:responseText"+a.responseText+"\n readyState"+a.readyState+"\n status"+a.status+"\ninfo:"+b+"\nexception:"+c)}})}function tabPk(a){$(".f_pk_person").unbind("tap");{var b=postUrl+"submitChooseid",c=$(".f_pk_person").eq(a).attr("playerId");$(".f_pk_person").eq(0).attr("vote"),$(".f_pk_person").eq(1).attr("vote")}chooseId=c,$.ajax({type:"POST",url:b,data:{openid:randomOpenid,sceneid:sceneid,choose:c},dataType:"jsonp",jsonp:"callback",timeout:globalTimeout,contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(b){(0==b.ret||1==b.ret)&&updateVoteNum(sceneid,a)},error:function(){}})}function renderJingcai(a){$("#banner2").show();var b=a.des.indexOf("/n"),c=a.des.substr(0,b),d=a.des.substr(b+2,a.des.length);c=zhuan(c),d=zhuan(d),$("#jc-txt1").html(c),$("#jc-txt2").html(d),$("#teamName").html(c),$("#jc-img img").attr("src",a.bpath),getJingcaiContent(sceneid),$("#check-jingcai").unbind(),$("#check-jingcai").show().bind("tap",function(){setLayerHeight($("#jingcai-layer")),$("#jingcai-layer").fadeIn(),updateJingcaiContent(sceneid),$(this).fadeOut()}),$("#jingcai-collapse").unbind(),$("#jingcai-collapse").bind("tap",function(){return $("#jingcai-layer").fadeOut(),$("#check-jingcai").fadeIn(),!1}),1==debugMode&&console.log("renderJingcai: data.bpath="+a.bpath,"data.des="+a.des)}function renderJingcaiLayer(a){$("#banner2").fadeIn(),$(".f_pk_person1").eq(0).attr("playerId",a.player[0].playerId),$(".f_pk_person2").eq(0).attr("playerId",a.player[1].playerId);var b=$(".f_pk_person").eq(0).find("img"),c=$(".f_pk_person").eq(1).find("img");$(".playerName").eq(0).html(a.player[0].playerName),$(".playerName").eq(1).html(a.player[1].playerName),a.win?($(".f_pk_vs").html(a.win==chooseId?"你猜对了</br>获得小梦香吻":"你猜错了</br>下轮继续"),a.player[0].playerId==a.win?($("#winBtnLeft").removeClass().addClass("winBtn").html("晋级"),$("#winBtnRight").removeClass().addClass("winBtn pkInBtn").html("淘汰"),b.attr("src",a.player[0].playerUrl.split(".png")[0]+"-light.png"),c.attr("src",a.player[1].playerUrl.split(".png")[0]+"-dark.png")):($("#winBtnRight").removeClass().addClass("winBtn").html("晋级"),$("#winBtnLeft").removeClass().addClass("winBtn pkInBtn").html("淘汰"),b.attr("src",a.player[0].playerUrl.split(".png")[0]+"-dark.png"),c.attr("src",a.player[1].playerUrl.split(".png")[0]+"-light.png"))):(b.attr("src",a.player[0].playerUrl),c.attr("src",a.player[1].playerUrl),$(".f_pk_person1").eq(0).attr("vote",a.result[0].vote),$(".f_pk_person2").eq(0).attr("vote",a.result[1].vote),$(".f_pk_vs").html(a.des+"</br>猜猜谁会晋级"),$("#winBtnRight").removeClass().addClass("winBtn").html("晋级"),$("#winBtnLeft").removeClass().addClass("winBtn").html("晋级"),$(".f_pk_person").bind("tap",function(){var a=$(this).index();tabPk(a)})),1==debugMode&&console.log("renderJingcaiLayer: num1="+num1,"num2="+num2,"name="+a.player[i].playerName)}function updateJingcaiLayer(a){for(i=0;i<a.player.length;i++){var b=a.result[i].selects[0].voteNum,c=a.result[i].selects[1].voteNum;$("#guesses_holder .single_guess").eq(i).find(".guess_bar2 span").eq(0).html(b),$("#guesses_holder .single_guess").eq(i).find(".guess_bar2 span").eq(1).html(c),1==debugMode&&console.log("updateJingcaiLayer: playerid="+a.result[i].playerid,"num1="+b,"num2="+c,"name="+a.player[i].playerName)}}function sendJingcai(a,b){var c=postUrl+"submitChooseid",d={openid:randomOpenid,appid:appid,sceneid:sceneid,choose:'{"playerid":'+a+',"yours":'+b+"}"};$.ajax({type:"POST",url:c,data:d,dataType:"jsonp",jsonp:"callback",timeout:globalTimeout,contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(a){0==a.ret,console.info("sendJingcai: ret="+a.ret)},error:function(a,b,c){1==debugMode&&alert("check it error http:responseText"+a.responseText+"\n readyState"+a.readyState+"\n status"+a.status+"\ninfo:"+b+"\nexception:"+c)}})}function renderResult(a){0==a.ret&&alert("111")}function showKiss(a,b){setTimeout(function(){$("#audio-kiss").get(0).play(),$("#kiss").addClass("animated3 bounceIn"),setTimeout(function(){$("#kiss").removeClass("animated3 bounceIn")},b)},3e3)}function renderGxlayer(a,b,c,d,e){function f(){$(".x_songname em").eq(0).html(a),$(".x_songname em").eq(1).html(b);var c=a/(parseInt(a)+parseInt(b))*100+"%",d=b/(parseInt(a)+parseInt(b))*100+"%";$(".votedata span").eq(0).width(c),$(".votedata span").eq(1).width(d)}function g(){$(".votedata span").width("0%")}$("#gx-triggers").show(),$("#check-trigger").hide(),$(".votedata span").eq(0).width("0"),$(".votedata span").eq(1).width("0"),0!=e&&($("#gx-triggers").hide(),$("#check-trigger").fadeIn()),$("#gx-triggers li").unbind(),$("#gx-triggers li").bind("tap",function(){setLayerHeight($("#gx-layer"));var e=$(this).index();0==e?(submitMychoose(c),a++):(submitMychoose(d),b++)}),$("#check-it").unbind(),$("#check-it").bind("tap",function(){var c=postUrl+"showSubmitResult",d={openid:randomOpenid,appid:appid,sceneid:sceneid};$.ajax({type:"POST",url:c,data:d,dataType:"jsonp",jsonp:"callback",timeout:globalTimeout,contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(c){0==c.ret&&(a=c.clist[0].num,b=c.clist[1].num,$("#gx-layer").fadeIn(400),$("#check-trigger").hide(),g(),f()),console.info("showSubmitResult ret="+c.ret)},error:function(a,b,c){1==debugMode&&alert("check it error http:responseText"+a.responseText+"\n readyState"+a.readyState+"\n status"+a.status+"\ninfo:"+b+"\nexception:"+c)}})}),$("#gx-collapse").bind("tap",function(){return $("#gx-layer").fadeOut(400),$("#check-trigger").show(),g(),!1})}function submitMychoose(a){var b=postUrl+"submitChooseid",c={openid:randomOpenid,appid:appid,sceneid:sceneid,choose:a};$.ajax({type:"POST",url:b,data:c,dataType:"jsonp",jsonp:"callback",timeout:globalTimeout,contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(b){0==b.ret&&($("#gx-triggers").hide(),$("#check-trigger").fadeIn()),1==debugMode&&console.log("submitMychoose: ret "+b.ret,"myChooseid:"+a)},error:function(a,b,c){alert("发送失败，请稍后重试！"),1==debugMode&&alert("submit choose error http:responseText"+a.responseText+"\n readyState"+a.readyState+"\n status"+a.status+"\ninfo:"+b+"\nexception:"+c)}})}function submitMyDati(a,b){var c=postUrl+"submitChooseid",d={openid:randomOpenid,appid:appid,sceneid:sceneid,choose:a};$.ajax({type:"POST",url:c,data:d,dataType:"jsonp",jsonp:"callback",timeout:globalTimeout,contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(c){0==c.ret&&$("#dati-btns span").eq(b).addClass("on"),1==debugMode&&console.log("submitMyDati: ret "+c.ret,"myChooseid:"+a)},error:function(a,b,c){alert("发送失败，请稍后重试！"),1==debugMode&&alert("http:responseText"+a.responseText+"\n readyState"+a.readyState+"\n status"+a.status+"\ninfo:"+b+"\nexception:"+c)}})}function startBQ(){var a=[0,0,0,0,0,0,0,0,0,0];$("#bq-holder li span").bind("tap",function(){if(console.log(a[0]-a[1]),a[0]-a[9]<16e3&&a[0]-a[9]>0)forbidenBQ(6e4),alert("提醒！短时间内发过多表情将被禁发表情30秒！");else{var b="images/biaoqing_gif/"+$(this).attr("title");sendMsg(b,1),pushMyMsg(b),a.unshift(Date.parse(new Date)),a.length>9&&a.pop()}return!1})}function forbidenBQ(a){$("#bq-holder li span").unbind("tap"),setTimeout(startBQ,a)}function preloadImg(){$("body").append('<div id="imgHolder" class="hidden"></div>'),$("#imgHolder").append('<img src="images/biaoqing_gif/bq01.gif">'),$("#imgHolder").append('<img src="images/biaoqing_gif/bq02.gif">'),$("#imgHolder").append('<img src="images/biaoqing_gif/bq03.gif">'),$("#imgHolder").append('<img src="images/biaoqing_gif/bq04.gif">'),$("#imgHolder").append('<img src="images/biaoqing_gif/bq05.gif">'),$("#imgHolder").append('<img src="images/biaoqing_gif/bq06.gif">'),$("#imgHolder").append('<img src="images/biaoqing_gif/bq07.gif">'),$("#imgHolder").append('<img src="images/biaoqing_gif/bq08.gif">'),$("#imgHolder").append('<img src="images/biaoqing_gif/bqn01.gif">'),$("#imgHolder").append('<img src="images/biaoqing_gif/bqn02.gif">'),$("#imgHolder").append('<img src="images/biaoqing_gif/bqn03.gif">'),$("#imgHolder").append('<img src="images/biaoqing_gif/bqn04.gif">'),$("#imgHolder").append('<img src="images/biaoqing_gif/bqn05.gif">'),$("#imgHolder").append('<img src="images/biaoqing_gif/bqn06.gif">'),$("#imgHolder").append('<img src="images/biaoqing_gif/bqn07.gif">'),$("#imgHolder").append('<img src="images/biaoqing_gif/bqn08.gif">'),$("body").scrollTo(0,200)}function increaseNumber(){Jump=416+parseInt(16*Math.random()),startNumber+=Jump,$("#people-num").html(startNumber)}function timeToshow(){var a=(new Date).getTime();a>new Date(todayYMD1).getTime()&&a<new Date(todayYMD2).getTime()?(increaseNumber(),$("#banner-all").fadeIn()):$("#banner-all").fadeOut(),setTimeout(timeToshow,jumpInterval)}!function(a,b){var c,d,e,f;a.tapHandling=!1,c=function(c){return c.each(function(){function c(a){b(a.target).trigger("tap",[a,b(a.target).attr("href")]),a.stopImmediatePropagation()}function d(a){var b=a.originalEvent||a,c=b.touches||b.targetTouches;return c?[c[0].pageX,c[0].pageY]:null}function e(a){if(a.touches&&a.touches.length>1||a.targetTouches&&a.targetTouches.length>1)return!1;var b=d(a);j=b[0],i=b[1]}function f(a){if(!k){var b=d(a);b&&(Math.abs(i-b[1])>m||Math.abs(j-b[0])>m)&&(k=!0)}}function g(b){if(clearTimeout(h),h=setTimeout(function(){a.tapHandling=!1,k=!1},1e3),!(b.which&&b.which>1||b.shiftKey||b.altKey||b.metaKey||b.ctrlKey)){if(b.preventDefault(),k||a.tapHandling&&a.tapHandling!==b.type)return void(k=!1);a.tapHandling=b.type,c(b)}}var h,i,j,k,l=b(this),m=10;l.bind("touchstart.tappy MSPointerDown.tappy",e).bind("touchmove.tappy MSPointerMove.tappy",f).bind("touchend.tappy MSPointerUp.tappy",g).bind("click.tappy",g)})},d=function(a){return a.unbind(".tappy")},b.event&&b.event.special?b.event.special.tap={add:function(){c(b(this))},remove:function(){d(b(this))}}:(e=b.fn.bind,f=b.fn.unbind,b.fn.bind=function(a){return/(^| )tap( |$)/.test(a)&&c(this),e.apply(this,arguments)},b.fn.unbind=function(a){return/(^| )tap( |$)/.test(a)&&d(this),f.apply(this,arguments)})}(this,jQuery),!function(a){function b(a){return"object"==typeof a?a:{top:a,left:a}}var c=a.scrollTo=function(b,c,d){a(window).scrollTo(b,c,d)};c.defaults={axis:"y",duration:1},c.window=function(){return a(window).scrollable()},a.fn.scrollable=function(){return this.map(function(){var b=this.parentWindow||this.defaultView,c="#document"==this.nodeName?b.frameElement||b:this,d=c.contentDocument||(c.contentWindow||c).document,e=c.setInterval;return"IFRAME"==c.nodeName||e&&a.browser.safari?d.body:e?d.documentElement:this})},a.fn.scrollTo=function(d,e,f){return"object"==typeof e&&(f=e,e=0),"function"==typeof f&&(f={onAfter:f}),f=a.extend({},c.defaults,f),e=e||f.speed||f.duration,f.queue=f.queue&&f.axis.length>1,f.queue&&(e/=2),f.offset=b(f.offset),f.over=b(f.over),this.scrollable().each(function(){function c(a){j.animate(l,e,f.easing,a&&function(){a.call(this,d,f)})}function g(a){var b="scroll"+a,c=i.ownerDocument;return m?Math.max(c.documentElement[b],c.body[b]):i[b]}var h,i=this,j=a(i),k=d,l={},m=j.is("html,body");switch(typeof k){case"number":case"string":if(/^([+-]=)?\d+(px)?$/.test(k)){k=b(k);break}k=a(k,this);case"object":(k.is||k.style)&&(h=(k=a(k)).offset())}a.each(f.axis.split(""),function(a,b){var d="x"==b?"Left":"Top",e=d.toLowerCase(),n="scroll"+d,o=i[n],p="x"==b?"Width":"Height",q=p.toLowerCase();h?(l[n]=h[e]+(m?0:o-j.offset()[e]),f.margin&&(l[n]-=parseInt(k.css("margin"+d))||0,l[n]-=parseInt(k.css("border"+d+"Width"))||0),l[n]+=f.offset[e]||0,f.over[e]&&(l[n]+=k[q]()*f.over[e])):l[n]=k[e],/^\d+$/.test(l[n])&&(l[n]=l[n]<=0?0:Math.min(l[n],g(p))),!a&&f.queue&&(o!=l[n]&&c(f.onAfterFirst),delete l[n])}),c(f.onAfter)}).end()}}(jQuery),isWeiXin();var wHeight,wWidth=$(window).width(),headHeight=45,bannerHeight=113,chatMarginHeight=0,inputHeight=46;$(window).resize(position_monitor).load(position_monitor),$("#share-trigger").bind("tap",function(){$("#pop_share").fadeIn()}),$("#close-pop").bind("tap",function(){$("#pop_share").fadeOut()});var randomOpenid,lastMsgTime=0,appid,key,timeStamp,roomPeople,userMsg,ccode,flashInterval=3e3,enterRoomInterval=5e3,intervalGetChat,intervalEnterRoom,postUrl="http://192.168.0.106:8080/DragonTV/",sceneid=0,scenebt=0,mySex,myNick,myDeco,myIcon,myMessageId=0,flashLimit=0,totalMessageNumber=0,lastChat,chooseId=3,debugMode=!1,yanshiMode=!1,myRoomNumber,version=4.2,globalTimeout=1e4,reenterUrl="http://www.weshaketv.com/wycloud/oauth?appid=DFWS&redirect_url=http://1251097942.cdn.myqcloud.com/1251097942/chat_v2.0/index.html&error_url=http://1251097942.cdn.myqcloud.com/1251097942/welcome_v2.4/failed.html&scope=1";randomOpenid=getParameter("openid"),myNick=getParameter("nickname"),myIcon=decodeURIComponent(getParameter("icon")),mySex=getParameter("sex"),appid=getParameter("appid"),key=getParameter("key"),timeStamp=getParameter("timeStamp"),""==myIcon&&(myIcon="images/default_photo.jpg",myIcon=decodeURIComponent(myIcon)),""==myNick&&(myNick="神秘人物"+parseInt(2e3*Math.random())),""==mySex&&(mySex=2),""==randomOpenid&&(randomOpenid=parseInt(2e3*Math.random())),""==appid&&(appid="mzs"),enterRoom(),window.zhuan=function(a){return"string"==typeof a&&(a=a.replace(/</,"&lt;"),a=a.replace(/>/,"&gt;"),a=a.replace(/"/,"&quot;")),a},$("#send-trigger").bind("tap",function(){return userMsg=$("#input-content").val(),"@debugmode"==userMsg?(debugMode=!0,alert("debug模式开启"),$("#input-content").blur().val("")):"@version"==userMsg?(alert("当前版本号是"+version),$("#input-content").blur().val("")):"@myroomid"==userMsg?(alert("我的房间号是: "+myRoomNumber),$("#input-content").blur().val("")):"@url"==userMsg?(alert("reenterUrl: "+reenterUrl),$("#input-content").blur().val("")):"@sendpara"==userMsg?(alert("sendPara:  openid="+randomOpenid+"\n appid="+appid+"\n timeStamp="+timeStamp+"\n key="+key+"\n usericon="+encodeURIComponent(myIcon)+"\n usernick="+encodeURIComponent(myNick)+"\n usersex="+mySex),$("#input-content").blur().val("")):""!=userMsg&&" "!=userMsg&&(sendMsg(userMsg,0),pushMyMsg(userMsg),$("#input-content").blur().val(""),$("body").scrollTo(0,200),lastMsgTime=Date.parse(new Date)),!1}),document.onkeydown=function(a){var b=a||window.event;b&&13==b.keyCode&&$("#send-trigger").click()},$("#exit-trigger").bind("tap",function(){var a=postUrl+"exit",b={openid:randomOpenid,appid:appid,appid:appid};return $.ajax({type:"POST",url:a,data:b,dataType:"jsonp",jsonp:"callback",timeout:globalTimeout,contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(){WeixinApi.closeWindow()},error:function(a,b,c){1==debugMode&&alert("http:responseText"+a.responseText+"\n readyState"+a.readyState+"\n status"+a.status+"\ninfo:"+b+"\nexception:"+c)}}),clearInterval(intervalGetChat),!1}),$("#check-tuwen").bind("tap",function(){setLayerHeight($("#tuwen-layer")),$(this).hide(),$("#tuwen-layer").fadeIn()}),$("#tuwen-collapse").bind("tap",function(){return $("#tuwen-layer").fadeOut(400),$("#check-tuwen").show(),!1}),$(window).bind("orientationchange",function(){orient()}),$("#bq-trigger").bind("tap",function(a){return document.body.scrollTop>0?($("body").scrollTo(0,200),setTimeout(function(){$("#bq-holder").hide()},400)):($("body").scrollTo(164,200),$("#bq-holder").show()),a.stopPropagation(),!1}),$("#chatBlock").bind("tap",function(){return $("#input-content").blur(),$("body").scrollTo(0,200),setTimeout(function(){$("#bq-holder").hide()},400),!1}),$("#bq-holder").flexslider({animation:"slide",animationSpeed:400,slideshowSpeed:4e3,directionNav:!1,controlNav:!0,slideshow:!1,animationLoop:!1,start:function(){$("#bq-holder").hide()}}),startBQ(),preloadImg();var myDate=new Date,todayYear=myDate.getFullYear(),todayMonth=myDate.getMonth()+1,todayDate=myDate.getDate(),todayYMD=todayYear+"/"+todayMonth+"/"+todayDate,todayYMD1=todayYMD+" 22:38:00",todayYMD2=todayYMD+" 22:42:43",nowTime=(new Date).getTime(),gapTime=parseInt((nowTime-new Date(todayYMD1).getTime())/1e3),startNumber=parseInt(141.34*gapTime)+1282e3,Jump,jumpTimer,jumpInterval=3e3;timeToshow();